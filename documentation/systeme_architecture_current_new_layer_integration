 graph LR
    subgraph "CURRENT SYSTEM (What we have)"
        A["User Intent<br/>Natural Language"]
        B["LLMParser<br/>HTTP calls Python"]
        C["Python LLM Service<br/>Anthropic Claude"]
        D["Generated Rule<br/>Simple structure"]
        E["EventRuleEntity<br/>field/operator/value"]
        F["Simple Rule<br/>Execution"]
        
        A -->|description| B
        B -->|minimal context| C
        C -->|simple rule| D
        D -->|stored as| E
        E -->|triggers| F
    end
    
    subgraph "NEW LAYERS (What we built)"
        G["LLMContextEnricher<br/>enrichContextForComplex..."]
        H["Available Schemas<br/>Example Rules<br/>Composition Patterns<br/>Validation Services"]
        I["Enriched Context<br/>Full system knowledge"]
        J["EventRuleExtendedEntity<br/>Complex Rule Structure"]
        K["ExtendedRuleExecutor<br/>SERVICE_CALL conditions<br/>CONDITIONAL actions"]
        
        G -->|collects| H
        H -->|creates| I
        I -->|enables| J
        J -->|executed by| K
    end
    
    subgraph "INTEGRATION POINTS"
        L["TaskCompilerService<br/>.generateEventRuleFromIntent"]
        M["Inject Context<br/>Enricher"]
        N["Call LLM<br/>with enriched context"]
        O["Assess Rule<br/>Complexity"]
        P["Create Appropriate<br/>Entity"]
    end
    
    A -->|enters| L
    L --> M -->|enrich| G
    I -->|back to| N
    N --> O
    O -->|SIMPLE| E
    O -->|COMPOSED| J
    
    style A fill:#e1f5ff
    style G fill:#fff3e0
    style H fill:#fff3e0
    style I fill:#fce4ec
    style J fill:#e8f5e9
    style K fill:#c8e6c9
    style L fill:#f3e5f5
    style M fill:#f3e5f5