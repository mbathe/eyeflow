graph TB
    subgraph "1. LLM Context Enrichment Layer ðŸ”·"
        A["User Intent<br/>Document Schema Check<br/>+ Alert on Slack"]
        B["LLMContextEnhancedService<br/>connector list, function types"]
        C["LLMContextEnricherService<br/>+ available schemas<br/>+ complex examples<br/>+ validation services<br/>+ composition patterns"]
        A --> B --> C
    end
    
    subgraph "2. Python LLM Generation ðŸ§ "
        D["Anthropic Claude"]
        E["Enriched Context<br/>(schemas + examples +<br/>patterns + services)"]
        C -->|send full context| D
        E -.->|remembers patterns| D
        D -->|generates complex rule| F["Generated Rule<br/>SERVICE_CALL condition<br/>CONDITIONAL actions<br/>Document references"]
    end
    
    subgraph "3. NestJS Rule Translation ðŸ“‹"
        G["LLM Rule Response<br/>complex structure"]
        H["Task Compiler Service<br/>validates & resolves<br/>document references"]
        I["Heuristic Resolver<br/>maps to real connectors"]
        J["EventRuleExtendedEntity<br/>stores complex rule"]
        F --> G
        G --> H --> I --> J
    end
    
    subgraph "4. Rule Execution ðŸš€"
        K["Rule Trigger<br/>file added to folder"]
        L["Evaluate condition<br/>SERVICE_CALL to<br/>schema validator"]
        M["Fetch Schema<br/>from doc ref"]
        N["Validate Document"]
        O["Condition Result<br/>Valid or Invalid"]
        P["Execute Composed<br/>Action<br/>IF/ELSE logic"]
        Q["Action 1:<br/>Update status"]
        R["Action 2:<br/>Send Slack<br/>with details"]
        K --> L
        L --> M --> N --> O
        O -->|valid| Q
        O -->|invalid| P --> R
        R -->|$result.errors| S["Slack Message<br/>with validation errorsâœ…"]
    end
    
    J -.->|contains composed structure| K
    
    style A fill:#e1f5ff
    style C fill:#fff3e0
    style D fill:#f3e5f5
    style F fill:#fce4ec
    style J fill:#e8f5e9
    style S fill:#c8e6c9